
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
        xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{user/layout/head :: head}"></head>

<body>

  <div class="page-wrapper">

    <!-- Preloader -->
    <div class="preloader"></div>

    <!-- Header Span -->
    <span class="header-span"></span>

    <!-- Main Header-->
    <header th:replace="~{user/layout/header :: header}"></header>
    <!--End Main Header -->

    <!--Page Title-->
    <section class="page-title">
      <div class="auto-container">
        <div class="title-outer">
          <h1>Danh sách ứng viên</h1>
          <ul class="page-breadcrumb">
            <li><a th:href="@{/}">Trang chủ</a></li>
            <li>Danh sách ứng viên</li>
          </ul>
        </div>
      </div>
    </section>
    <!--End Page Title-->

    <!-- Listing Section -->
    <section class="ls-section">
      <div class="auto-container">
        <div class="filters-backdrop"></div>

        <div class="row">

          <!-- Filters Column -->
          <div class="filters-column col-lg-4 col-md-12 col-sm-12">
            <div class="inner-column">
              <div class="filters-outer">
                <button type="button" class="theme-btn close-filters">X</button>
                <form id="filter-form" th:action="@{/tim-kiem-ungvien}" method="get">

                  <!-- Filter Block -->
                  <div class="filter-block">
                    <h4>Tìm kiếm theo từ khoá</h4>
                    <div class="form-group">
                      <input type="text" name="tuKhoa" th:value="${tuKhoa}" placeholder="Tên ứng viên, chuyên ngành...">
                      <span class="icon flaticon-search-3"></span>
                    </div>
                  </div>

                  <!-- Filter Block -->
                  <div class="filter-block">
                    <h4>Địa điểm</h4>
                    <div class="form-group">
                      <input type="text" name="diaChi" th:value="${diaChi}" placeholder="Thành phố hoặc vị trí">
                      <span class="icon flaticon-map-locator"></span>
                    </div>
                  </div>

                  

                  <!-- Filter Block -->
                  <div class="filter-block">
                    <h4>Giới tính</h4>
                    <div class="form-group">
                      <select name="gioiTinh" class="chosen-select">
                        <option value="">Tất cả</option>
                        <option value="Nam" th:selected="${gioiTinh == 'Nam'}">Nam</option>
                        <option value="Nữ" th:selected="${gioiTinh == 'Nữ'}">Nữ</option>
                        <option value="Khác" th:selected="${gioiTinh == 'Khác'}">Khác</option>
                      </select>
                      <span class="icon flaticon-heart-1"></span>
                    </div>
                  </div>


                  <!-- Checkboxes Ouer -->
                  <div class="checkbox-outer">
                    <h4>Kinh nghiệm</h4>
                    <ul class="checkboxes">
                      <li>
                        <input id="exp-all" type="checkbox" name="kinhNghiem" value="" 
                              th:checked="${kinhNghiem == null}">
                        <label for="exp-all">Tất cả</label>
                      </li>
                      <li>
                        <input id="exp-0" type="checkbox" name="kinhNghiem" value="0" 
                              th:checked="${kinhNghiem == '0'}">
                        <label for="exp-0">Mới ra trường</label>
                      </li>
                      <li>
                        <input id="exp-1-2" type="checkbox" name="kinhNghiem" value="1-2" 
                              th:checked="${kinhNghiem == '1-2'}">
                        <label for="exp-1-2">1-2 năm</label>
                      </li>
                      <li>
                        <input id="exp-3-5" type="checkbox" name="kinhNghiem" value="3-5" 
                              th:checked="${kinhNghiem == '3-5'}">
                        <label for="exp-3-5">3-5 năm</label>
                      </li>
                      <li>
                        <input id="exp-6-9" type="checkbox" name="kinhNghiem" value="6-9" 
                              th:checked="${kinhNghiem == '6-9'}">
                        <label for="exp-6-9">6-9 năm</label>
                      </li>
                      <li>
                        <input id="exp-10+" type="checkbox" name="kinhNghiem" value="10+" 
                              th:checked="${kinhNghiem == '10+'}">
                        <label for="exp-10+">10+ năm</label>
                      </li>
                    </ul>
                  </div>
                  <div class="form-group mt-4">
                    <button type="submit" class="theme-btn btn-style-four w-50">
                      <span class="btn-title">Áp dụng</span>
                    </button>
                    <a th:href="@{/dsungvien}" class="theme-btn btn-style-eight w-45">
                      <span class="btn-title">Xóa bộ lọc</span>
                    </a>
                  </div>
                  
                </form>
              </div>
            </div>
          </div>


          <!-- Content Column -->
          <div class="content-column col-lg-8 col-md-12 col-sm-12">
            <div class="ls-outer">
              <button type="button" class="theme-btn btn-style-two toggle-filters">Show Filters</button>

              <!-- ls Switcher -->
              <div class="ls-switcher">
                <div class="showing-result">
                  <div class="text" th:if="${dSUngVien != null && !dSUngVien.isEmpty()}">
                    Hiển thị <strong th:text="${currentPage * size + 1}">1</strong>-<strong th:text="${(currentPage * size) + dSUngVien.size()}">12</strong> 
                    trong số <strong th:text="${totalItems}">100</strong> ứng viên
                  </div>
                  <div class="text" th:if="${dSUngVien == null || dSUngVien.isEmpty()}">
                    Không tìm thấy ứng viên nào
                  </div>
                </div>
                <div class="sort-by">
                  <select class="chosen-select" id="sortSelect">
                    <option value="hoTen-asc" th:selected="${sort == 'hoTen' && direction == 'asc'}">Tên A-Z</option>
                    <option value="hoTen-desc" th:selected="${sort == 'hoTen' && direction == 'desc'}">Tên Z-A</option>
                    <option value="namKinhNghiem-desc" th:selected="${sort == 'namKinhNghiem' && direction == 'desc'}">Kinh nghiệm cao nhất</option>
                    <option value="namKinhNghiem-asc" th:selected="${sort == 'namKinhNghiem' && direction == 'asc'}">Kinh nghiệm thấp nhất</option>
                  </select>

                  <select class="chosen-select" id="pageSizeSelect">
                    <option value="12" th:selected="${size == 12}">Hiện 12</option>
                    <option value="24" th:selected="${size == 24}">Hiện 24</option>
                    <option value="36" th:selected="${size == 36}">Hiện 36</option>
                    <option value="48" th:selected="${size == 48}">Hiện 48</option>
                  </select>
                </div>
              </div>              
              <div class="row">
                <!-- Hiển thị thông báo nếu không có ứng viên -->
                <div class="col-12" th:if="${#lists.isEmpty(dSUngVien)}">
                  <div class="alert alert-info text-center">
                    <h4>Không có ứng viên nào!</h4>
                  </div>
                </div>
                
                <div class="candidate-block-four col-lg-6 col-md-6 col-sm-12" th:each="ungVien : ${dSUngVien}">
                  <div class="inner-box">
                    <ul class="job-other-info">
                      <li class="green" th:if="${ungVien.namKinhNghiem > 0}" 
                          th:text="${ungVien.namKinhNghiem} + ' năm KN'">Kinh nghiệm</li>
                      <li class="purple" th:if="${ungVien.namKinhNghiem == 0 || ungVien.namKinhNghiem == null}">Mới ra trường</li>
                    </ul>
                    <span class="thumb">
                      <img th:if="${ungVien.hinhAnh != null}" th:src="@{'/fe/images/resource/avatar/' + ${ungVien.hinhAnh}}" alt="Candidate Image">
                      <img th:unless="${ungVien.hinhAnh != null}" th:src="@{/fe/images/resource/avatar/default.jpg}" alt="Default Avatar">
                    </span>                    
                    <h3 class="name">
                      <a th:href="@{'/chitiet-ungvien/' + ${ungVien.id}}" th:text="${ungVien.hoTen != null ? ungVien.hoTen : ungVien.username}">Tên ứng viên</a>
                    </h3>
                    <span class="cat" th:text="${ungVien.chuyenNganh != null ? ungVien.chuyenNganh : 'Chưa cập nhật'}">Chuyên ngành</span>
                    <ul class="job-info">
                      <li th:if="${ungVien.diaChi != null}">
                        <span class="icon flaticon-map-locator"></span>
                        <span th:text="${ungVien.diaChi}">Địa chỉ</span>
                      </li>
                      <li th:if="${ungVien.luongMongMuon > 0}">
                        <span class="icon flaticon-money"></span>
                        <span th:text="${ungVien.luongMongMuon} + ' triệu VNĐ'">Lương mong muốn</span>
                      </li>
                    </ul>
                    <ul class="post-tags" th:if="${ungVien.ngonNgu != null}">
                      <li><a href="#" th:text="${ungVien.ngonNgu}">Ngôn ngữ</a></li>
                    </ul>
                    <a th:href="@{'/chitiet-ungvien/' + ${ungVien.id}}" class="theme-btn btn-style-three">Xem hồ sơ</a>
                  </div>
                </div>
              </div>

              <!-- Pagination -->
              <nav class="ls-pagination" th:if="${totalPages > 0}">
                <ul>
                  <!-- Nút Previous -->
                  <li class="prev" th:classappend="${currentPage == 0 ? 'disabled' : ''}">
                    <a th:if="${currentPage > 0}" 
                      th:href="@{${currentUrl}(page=${currentPage - 1}, size=${size}, sort=${sort}, direction=${direction}, tuKhoa=${tuKhoa}, diaChi=${diaChi}, gioiTinh=${gioiTinh}, kinhNghiem=${kinhNghiem})}">
                      <i class="fa fa-arrow-left"></i>
                    </a>
                    <span th:unless="${currentPage > 0}"><i class="fa fa-arrow-left"></i></span>
                  </li>

                  <!-- First page -->
                  <li th:if="${startPage > 0}">
                    <a th:href="@{${currentUrl}(page=0, size=${size}, sort=${sort}, direction=${direction}, tuKhoa=${tuKhoa}, diaChi=${diaChi}, gioiTinh=${gioiTinh}, kinhNghiem=${kinhNghiem})}">1</a>
                  </li>

                  <!-- Ellipsis after first page if needed -->
                  <li th:if="${startPage > 1}">
                    <span>...</span>
                  </li>

                  <!-- Pages -->
                  <li th:each="i: ${#numbers.sequence(startPage, endPage)}" 
                      th:class="${i == currentPage ? 'current-page' : ''}">
                    <a th:href="@{${currentUrl}(page=${i}, size=${size}, sort=${sort}, direction=${direction}, tuKhoa=${tuKhoa}, diaChi=${diaChi}, gioiTinh=${gioiTinh}, kinhNghiem=${kinhNghiem})}" 
                      th:text="${i + 1}"></a>
                  </li>

                  <!-- Ellipsis before last page if needed -->
                  <li th:if="${endPage < totalPages - 2}">
                    <span>...</span>
                  </li>

                  <!-- Last page -->
                  <li th:if="${endPage < totalPages - 1}">
                    <a th:href="@{${currentUrl}(page=${totalPages - 1}, size=${size}, sort=${sort}, direction=${direction}, tuKhoa=${tuKhoa}, diaChi=${diaChi}, gioiTinh=${gioiTinh}, kinhNghiem=${kinhNghiem})}" 
                      th:text="${totalPages}"></a>
                  </li>

                  <!-- Nút Next -->
                  <li class="next" th:classappend="${currentPage == totalPages - 1 ? 'disabled' : ''}">
                    <a th:if="${currentPage < totalPages - 1}" 
                      th:href="@{${currentUrl}(page=${currentPage + 1}, size=${size}, sort=${sort}, direction=${direction}, tuKhoa=${tuKhoa}, diaChi=${diaChi}, gioiTinh=${gioiTinh}, kinhNghiem=${kinhNghiem})}">
                      <i class="fa fa-arrow-right"></i>
                    </a>
                    <span th:unless="${currentPage < totalPages - 1}"><i class="fa fa-arrow-right"></i></span>
                  </li>
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!--End Listing Page Section -->
    <!-- Main Footer -->
    <div th:replace="~{user/layout/footer :: footer}"></div>
  <!-- End Main Footer -->


  </div><!-- End Page Wrapper -->

  <div th:replace="~{user/layout/script :: script}"></div>
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    // Xử lý thay đổi số lượng hiển thị mỗi trang
    document.getElementById('pageSizeSelect').addEventListener('change', function() {
      // Lấy các tham số hiện tại từ URL
      var urlParams = new URLSearchParams(window.location.search);
      urlParams.set('page', '0'); // Quay về trang đầu tiên khi đổi size
      urlParams.set('size', this.value);
      
      // Tạo URL mới
      var newUrl = window.location.pathname + '?' + urlParams.toString();
      window.location.href = newUrl;
    });
    
    // Xử lý thay đổi sắp xếp
    document.getElementById('sortSelect').addEventListener('change', function() {
      var sortValues = this.value.split('-');
      var sort = sortValues[0];
      var direction = sortValues[1];
      
      // Lấy các tham số hiện tại từ URL
      var urlParams = new URLSearchParams(window.location.search);
      urlParams.set('sort', sort);
      urlParams.set('direction', direction);
      
      // Tạo URL mới
      var newUrl = window.location.pathname + '?' + urlParams.toString();
      window.location.href = newUrl;
    });
    
    // Xử lý các checkbox kinh nghiệm (nếu một checkbox được chọn, bỏ chọn các checkbox khác)
    var expCheckboxes = document.querySelectorAll('input[name="kinhNghiem"]');
    expCheckboxes.forEach(function(checkbox) {
      checkbox.addEventListener('change', function() {
        if (this.checked) {
          expCheckboxes.forEach(function(cb) {
            if (cb !== checkbox) {
              cb.checked = false;
            }
          });
        }
      });
    });
  });
</script>
</body>

</html>