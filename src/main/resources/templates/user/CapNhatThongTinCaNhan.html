
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
        xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{user/layout/head :: head}">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/> 
</head>

<body>

  <div class="page-wrapper dashboard ">

    <!-- Preloader -->
    <div class="preloader"></div>

    <!-- Header Span -->
    <span class="header-span"></span>

    <!-- Main Header-->
    <header th:replace="~{user/layout/header :: header}"></header>
    <!--End Main Header -->

    <!-- Sidebar Backdrop -->
    <div class="sidebar-backdrop"></div>

    <!-- User Sidebar -->
     <div sec:authorize="hasAuthority('RECRUITER')">
      <div th:replace="~{nhatuyendung/layout/sidebar :: sidebar}"></div>
    </div>
    <div sec:authorize="hasAuthority('CANDIDATE')">
      <div th:replace="~{ungvien/layout/sidebar :: sidebar}"></div>
    </div>
    <div sec:authorize="hasAuthority('CV_STAFF')">
      <div th:replace="~{nvhs/layout/sidebar :: sidebar}"></div>
    </div>
    <div sec:authorize="hasAuthority('HR_STAFF')">
      <div th:replace="~{nvtd/layout/sidebar :: sidebar}"></div>
    </div>
    <!-- End User Sidebar -->

    <!-- Dashboard -->
    <section class="user-dashboard">
      <div class="dashboard-outer">
        <div class="upper-title-box">
          <h3>Thông tin cá nhân!</h3>
        </div>
        
        <div class="alert alert-success" th:if="${success}" th:text="${success}"></div>
        <div class="alert alert-danger" th:if="${error}" th:text="${error}"></div>

        <div class="row">
          <div class="col-lg-12">
            <!-- Ls widget -->
            <div class="ls-widget">
                <div class="tabs-box">
                    <div class="widget-title">
                        <h4>Thông tin cơ bản</h4>
                    </div>
                    <div class="widget-content">
                        <form class="default-form" method="post" th:action="@{/user/edit-user}" enctype="multipart/form-data" th:object="${user}">
                            <div class="uploading-outer">
                                <div class="uploadButton">
                                    <input class="uploadButton-input" type="file" name="avatarFile" accept="image/*" id="upload" />
                                    <label class="uploadButton-button ripple-effect" for="upload">Chọn avatar</label>
                                    <span class="uploadButton-file-name"></span>
                                </div>
                                <div class="text">Dung lượng tối đa 1MB, kích thước tối thiểu: 330x300, định dạng .jpg & .png</div>
                                <div th:if="${user != null && user.hinhAnh != null}" class="mt-3">
                                    <p>Avatar hiện tại:</p>
                                    <img th:src="@{'/fe/images/resource/avatar/' + ${user.hinhAnh}}" alt="Avatar hiện tại" style="max-width: 200px; max-height: 150px;">
                                </div>
                            </div>

                            <div class="row">
                            <!-- Họ tên -->
                                <div class="form-group col-lg-6 col-md-12">
                                    <label>Họ tên <span class="required">*</span></label>
                                    <input type="text" th:field="*{hoTen}" name="hoTen" required placeholder="Nhập họ tên">
                                </div>

                            <!-- Email -->
                                <div class="form-group col-lg-6 col-md-12">
                                    <label>Email</label>
                                    <input type="email" th:field="*{email}" name="email" readonly>
                                </div>

                            <!-- Số điện thoại -->
                                <div class="form-group col-lg-6 col-md-12">
                                    <label>Số điện thoại</label>
                                    <input type="text" th:field="*{soDienThoai}" name="soDienThoai" placeholder="Nhập số điện thoại">
                                </div>
                            <!-- Giới tính -->
                                <div class="form-group col-lg-6 col-md-12">
                                    <label>Giới tính</label>
                                    <select class="chosen-select" th:field="*{gioiTinh}" name="gioiTinh">
                                        <option value="">-- Chọn giới tính --</option>
                                        <option value="Nam">Nam</option>
                                        <option value="Nữ">Nữ</option>
                                        <option value="Khác">Khác</option>
                                    </select>
                                </div>
                            <!-- Tuổi -->
                                <div class="form-group col-lg-6 col-md-12">
                                    <label>Tuổi</label>
                                    <input type="number" th:field="*{tuoi}" name="tuoi" min="0" placeholder="Nhập tuổi">
                                </div>
                            <!-- Chuyên ngành -->
                                <div class="form-group col-lg-6 col-md-12">
                                    <label>Chuyên ngành</label>
                                    <input type="text" th:field="*{chuyenNganh}" name="chuyenNganh" placeholder="Nhập chuyên ngành">
                                </div>

                            <!-- Giới thiệu bản thân -->
                                <div class="form-group col-lg-12 col-md-12">
                                    <label>Giới thiệu bản thân</label>
                                    <textarea th:field="*{gioiThieu}" name="gioiThieu" placeholder="Giới thiệu về bản thân"></textarea>
                                </div>
                                <div class="form-group col-lg-12 col-md-12">
                                    <button type="submit" class="theme-btn btn-style-one">Lưu</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
          </div>

            <!-- Ls widget -->
            <div class="ls-widget">
              <div class="tabs-box">
                <div class="widget-title">
                  <h4>Mạng xã hội</h4>
                </div>

                <div class="widget-content">
                  <form class="default-form" method="post" th:action="@{/user/edit-mxh}" th:object="${user}">
                    <div class="row">
                      <!-- Facebook -->
                      <div class="form-group col-lg-6 col-md-12">
                        <label>Facebook</label>
                        <input type="text" th:field="*{faceBook}" name="faceBook" placeholder="www.facebook.com/ten-user">
                      </div>

                      <!-- LinkedIn -->
                      <div class="form-group col-lg-6 col-md-12">
                        <label>LinkedIn</label>
                        <input type="text" th:field="*{linkedIn}" name="linkedIn" placeholder="www.linkedin.com/in/ten-user">
                      </div>

                      <!-- Nút lưu -->
                      <div class="form-group col-lg-12 col-md-12">
                        <button type="submit" class="theme-btn btn-style-one">Lưu</button>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>

            <!-- Ls widget -->
            <div class="ls-widget">
              <div class="tabs-box">
                <div class="widget-title">
                  <h4>Địa chỉ</h4>
                </div>

                <div class="widget-content">
                    <form class="default-form" method="post" th:action="@{/user/edit-diachi}" th:object="${user}">
                        <div class="row">
                            <div class="form-group col-lg-6 col-md-12">
                                <label>Địa chỉ</label>
                                <input type="text" th:field="*{diaChi}" name="diaChi" placeholder="Nhập địa chỉ của bạn">
                            </div>

                            <div class="form-group col-lg-12 col-md-12">
                                <button class="theme-btn btn-style-three">Search Location</button>
                            </div>


                            <div class="form-group col-lg-12 col-md-12">
                                <div class="map-outer">
                                    <div class="map-canvas map-height" data-zoom="12" data-lat="-37.817085" data-lng="144.955631" data-type="roadmap" data-hue="#ffc400" data-title="Envato" data-icon-path="images/resource/map-marker.png" data-content="Melbourne VIC 3000, Australia<br><a href='mailto:info@youremail.com'>info@youremail.com</a>">
                                    </div>
                                </div>
                            </div>

                            <div class="form-group col-lg-12 col-md-12">
                                <button type="submit" class="theme-btn btn-style-one">Lưu</button>
                            </div>
                        </div>
                    </form>
                </div>
              </div>
            </div>

          </div>


        </div>
      </div>
    </section>
    <!-- End Dashboard -->

    <!-- Copyright -->
    <div th:replace="~{nhatuyendung/layout/footer :: footer}"></div>

  </div><!-- End Page Wrapper -->


  <div th:replace="~{user/layout/script :: script}"></div>
  <!--Google Map APi Key-->
  <script src="http://maps.google.com/maps/api/js?key=AIzaSyDaaCBm4FEmgKs5cfVrh3JYue3Chj1kJMw&amp;ver=5.2.4"></script>
  <script th:src="@{/fe/js/map-script.js}"></script>
  <!--End Google Map APi-->
  <!-- Thêm vào phần script ở cuối trang -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Hiển thị tên file khi chọn file
    document.getElementById('upload-cv').addEventListener('change', function() {
      var fileName = this.files[0].name;
      var fileNameDisplay = document.querySelector('.uploadButton-file-name');
      fileNameDisplay.textContent = fileName;
    });
    
    // Xử lý nút xóa CV
    var deleteBtn = document.getElementById('delete-cv');
    if (deleteBtn) {
    deleteBtn.addEventListener('click', function() {
        if (confirm('Bạn có chắc chắn muốn xóa CV hiện tại không?')) {
        // Gửi yêu cầu xóa CV mà không cần CSRF token
        fetch('/ungvien/delete-cv', {
            method: 'POST',
            credentials: 'same-origin' // Gửi cookies với request
        })
        .then(response => {
            if (response.ok) {
            location.reload();
            } else {
            response.text().then(text => {
                console.error('Lỗi:', text);
                alert('Đã xảy ra lỗi khi xóa CV');
            }).catch(() => {
                alert('Đã xảy ra lỗi khi xóa CV');
            });
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Đã xảy ra lỗi khi xóa CV');
        });
        }
    });
    }
    
    // Xử lý nút xóa học vấn, kinh nghiệm và thành tựu
    document.querySelectorAll('.delete-btn').forEach(function(btn) {
      btn.addEventListener('click', function(e) {
        if (!confirm('Bạn có chắc chắn muốn xóa mục này?')) {
          e.preventDefault();
        }
      });
    });
  });
</script>
</body>
</html>